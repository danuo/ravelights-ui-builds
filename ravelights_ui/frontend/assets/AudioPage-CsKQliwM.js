import{Q as et}from"./QPage-yUhJ2evf.js";import{y as V,z as g,d as st,A as h,B as i,E as W,L as m,F as d,C as a,W as C,M as k,a3 as G,D as S,V as y,N as D,a4 as ot,a5 as at,x as j,r as R,w as I,a6 as K,a7 as X,G as nt,U as it,R as L}from"./index-yLMKGSkL.js";import{Q as lt}from"./QInput-DV20IOYa.js";import{Q as rt}from"./QSlider-D9F6EnKq.js";import{Q as B}from"./QList-B843dnC0.js";import{U as Q}from"./UniversalControlComponent-DS3LnjFs.js";import{u as N}from"./app-store-BLE-9uWy.js";import{u as Y}from"./index-B-HE_1J3.js";import{A as E}from"./AudioEnums-C20TDQqa.js";import{u as P}from"./uPlot.min-BqCnoSue.js";import{U as Z}from"./uplot-vue-CWlSvh28.js";import{F as M}from"./FancyToggleComponent-Dz0wipn3.js";import"./use-key-composition-D9XKka2K.js";import"./uid-Bzmka5Fh.js";import"./selection-DHKgXy0P.js";import"./use-slider-CmuCgM4u.js";import"./QItemLabel-BV9vbiYw.js";import"./QToggle-Bn5XzZ6_.js";import"./QItemSection-ez-bpzzx.js";import"./QRange-1D1d5TWW.js";import"./QSelect-DwSINjRT.js";import"./QChip-ztJrneMM.js";import"./mappingFunctions-BCojnXZg.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ut={key:0,class:"q-mt-xs q-col-gutter-xs bpm-custom-styles"},ct={class:"row"},dt={class:"col-6",id:"bpm_input"},mt={class:"col-3"},pt={class:"col-3"},_t={class:"row"},ft={class:"col-6"},bt={class:"col-3"},ht={class:"col-3"},vt={class:"q-px-none q-mt-lg q-mb-md"},gt={class:"row flex-center",style:{width:"100%"}},xt={__name:"BpmComponent",setup(x){const t=V(),{settings:e}=g(t),l={0:"1/2",1:1,2:2},r=st({get(){return e.value.bpm_multiplier==.5?0:e.value.bpm_multiplier},set(u){e.value.bpm_multiplier=u==0?.5:u}});function n(){G("/rest/settings",{action:"set_sync"})}function _(u){G("/rest/settings",{action:"adjust_sync",value:u})}function f(u){e.value.bpm_base=parseFloat((e.value.bpm_base+u).toFixed(2)),t.set_settings("bpm_base")}return(u,s)=>(i(),h(k,null,[Object.keys(d(e)).length>0?(i(),h("div",ut,[m("div",ct,[m("div",dt,[a(lt,{modelValue:d(e).bpm_base,"onUpdate:modelValue":s[0]||(s[0]=p=>d(e).bpm_base=p),modelModifiers:{number:!0},outlined:""},null,8,["modelValue"])]),m("div",mt,[a(C,{onClick:s[1]||(s[1]=p=>f(.1)),square:!0,color:"primary",icon:"expand_less",size:"20px"})]),m("div",pt,[a(C,{onClick:s[2]||(s[2]=p=>f(-.1)),color:"primary",icon:"expand_more",size:"20px"})])]),m("div",_t,[m("div",ft,[a(C,{onClick:s[3]||(s[3]=p=>n()),label:"sync",color:"primary",size:"20px"})]),m("div",bt,[a(C,{onClick:s[4]||(s[4]=p=>_(.1)),color:"primary",icon:"navigate_before",size:"20px"})]),m("div",ht,[a(C,{onClick:s[5]||(s[5]=p=>_(-.1)),color:"primary",icon:"navigate_next",size:"20px"})])])])):W("",!0),m("div",vt,[s[8]||(s[8]=m("div",{style:{"padding-left":"16px"},class:"text-caption"},"bpm multiplier",-1)),m("div",gt,[a(rt,{onChange:s[6]||(s[6]=p=>d(t).set_settings("bpm_multiplier")),modelValue:r.value,"onUpdate:modelValue":s[7]||(s[7]=p=>r.value=p),color:"secondary","selection-color":"secondary","track-size":"15px","thumb-size":"30px",min:0,max:2,"marker-labels":l,snap:"",style:{width:"66%"}},null,8,["modelValue"])])])],64))}},yt={__name:"GeneralSettingsComponent",setup(x){const t=V();return(e,l)=>(i(),S(B,{bordered:"",separator:""},{default:y(()=>[(i(!0),h(k,null,D(d(t).meta.controls_global_sliders,r=>(i(),S(Q,{key:r.label,button:r},null,8,["button"]))),128))]),_:1}))}},kt=1500,J=ot("audio-aggr-store",{state:()=>({data:null,subscribers:0,totalTimeFrame:1,intervalId:null}),actions:{async fetchData(){console.log("fetching data"),this.data=await at("/rest/audio"),this.totalTimeFrame===1&&this.setTotalTimeFrame()},setTotalTimeFrame(){if(!this.data)return;const x=this.data.time_unix[0],e=this.data.time_unix[this.data.time_unix.length-1]-x,l=this.data.time_unix.length,r=this.data.capacity;this.totalTimeFrame=e/l*r},startFetching(){this.subscribers>0&&!this.intervalId&&(this.fetchData(),this.intervalId=setInterval(()=>void this.fetchData(),kt))},stopFetching(){this.subscribers===0&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},subscribe(){return console.log("subscribed"),this.subscribers++,this.startFetching(),()=>{this.subscribers--,this.stopFetching()}}}}),H=500,St=j({__name:"AudioEnergyChartUplot",setup(x){let t=null;function e(o){t=o}const l=R(null),{width:r}=Y(l),n=R(!1),_=V(),{settings:f}=g(_),u=N(),{enable_charts:s}=g(u),p=J(),{data:$,totalTimeFrame:F}=g(p);let v=null;const A=[E.level_low_filter,E.mapped,E.max,E.min,E.mean],T=[[],...A.map(()=>[])],q={ms:1,width:r.value,height:H,pxAlign:!1,series:[{label:"time"},...A.map(o=>({label:o,stroke:P[A.indexOf(o)],width:2}))],scales:{x:{time:!0},y:{auto:!1,range:[0,1]}},axes:[{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}},{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}}],legend:{show:!0,live:!1},cursor:{show:!1,drag:{x:!1,y:!1},lock:!0}};I($,o=>{if(!t||!o)return;const b=o.time_unix||[];T[0]=b,A.forEach((w,tt)=>{T[tt+1]=o[w]})}),I(r,()=>{U(r.value)});function U(o){q.width=o,t&&t.setSize({width:o,height:H})}K(()=>{n.value=!0,U(r.value)}),X(()=>{n.value=!1}),I([n,s,f],([o,b,w])=>{o&&b&&!w.performance_mode?(z(),v=p.subscribe(),requestAnimationFrame(c)):z()});function z(){v&&(v(),v=null)}function c(){if(!n.value||!s.value||f.value.performance_mode||!t)return;const o=Date.now(),w={min:o-F.value,max:o};t.setData(T,!1),t.setScale("x",w),requestAnimationFrame(c)}return(o,b)=>(i(),h("div",{style:{background:"black"},ref_key:"container",ref:l},[d(s)?(i(),S(d(Z),{key:0,data:T,options:q,onCreate:e})):W("",!0)],512))}}),O=500,At=1e3/20*300-50,wt=j({__name:"AudioGainChartUplot",setup(x){const t=R(!1),e=V(),{settings:l}=g(e),r=N(),{enable_charts:n}=g(r),_=J(),{data:f}=g(_);let u=null;function s(c){u=c}const p=R(null),{width:$}=Y(p);let F=null;const v=[[],[],[]],A={ms:1,width:T(),height:O,pxAlign:!1,series:[{label:"time"},{label:"rms",stroke:P[0],width:2,scale:"db"},{label:"lufs",stroke:P[1],width:2,scale:"db"}],scales:{x:{time:!0},db:{auto:!0}},axes:[{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}},{scale:"db",stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"},label:"level"}],legend:{show:!0,live:!1},cursor:{show:!1,drag:{x:!1,y:!1},lock:!0}};I(f,c=>{if(!u||!c)return;const o=c.time_unix||[],b=c.rms_db||[],w=c.lufs||[];v[0]=o,v[1]=b,v[2]=w}),I($,()=>{q($.value)});function T(){return document.body.clientWidth-32-6}function q(c){A.width=c,u&&u.setSize({width:c,height:O})}K(()=>{t.value=!0,q($.value)}),X(()=>{t.value=!1}),I([t,n,l],([c,o,b])=>{c&&o&&!b.performance_mode?(U(),F=_.subscribe(),requestAnimationFrame(z)):U()});function U(){F&&(F(),F=null)}function z(){if(!t.value||!n.value||l.value.performance_mode||!u)return;const c=Date.now(),b={min:c-At,max:c};u.setData(v,!1),u.setScale("x",b),requestAnimationFrame(z)}return(c,o)=>(i(),h("div",{style:{background:"black"},ref_key:"container",ref:p},[d(n)?(i(),S(d(Z),{key:0,data:v,options:A,onCreate:s})):W("",!0)],512))}}),Ct={__name:"AudioSettingsComponent",setup(x){const t=V(),{settings:e}=g(t);return(l,r)=>(i(),h(k,null,[a(B,{bordered:"",separator:"",class:"q-my-md"},{default:y(()=>[a(wt),(i(!0),h(k,null,D(d(t).meta.controls_audio.main,n=>(i(),S(Q,{key:n.label,button:n},null,8,["button"]))),128)),(i(!0),h(k,null,D(d(t).meta.controls_audio[d(e).audio_fade_mode],n=>(i(),S(Q,{key:n.label,button:n},null,8,["button"]))),128)),d(e).audio_fade_mode=="audio"?(i(),S(St,{key:0})):W("",!0)]),_:1}),a(B,{bordered:"",separator:"",class:"q-my-md"},{default:y(()=>[(i(!0),h(k,null,D(d(t).meta.controls_audio.blackout,n=>(i(),S(Q,{key:n.label,button:n},null,8,["button"]))),128))]),_:1})],64))}},Ft={class:"row q-col-gutter-sm q-pb-md"},Tt={class:"col-6"},It={class:"col-6"},Vt={__name:"AudioControlsWrapper",setup(x){const t=V(),e=N(),{enable_charts:l}=g(e),{settings:r}=g(t);return(n,_)=>(i(),h(k,null,[m("div",Ft,[m("div",Tt,[a(M,{modelValue:d(r).enable_audio_analysis,"onUpdate:modelValue":_[0]||(_[0]=f=>d(r).enable_audio_analysis=f),callback:()=>d(t).set_settings("enable_audio_analysis"),label:"Audio Analysis",icon:"mic",muted:"",fancy:""},null,8,["modelValue","callback"])]),m("div",It,[a(M,{modelValue:d(l),"onUpdate:modelValue":_[1]||(_[1]=f=>nt(l)?l.value=f:null),label:"Show Charts",icon:"show_chart",fancy:"",muted:""},null,8,["modelValue"])])]),a(Ct)],64))}},ee={__name:"AudioPage",setup(x){return(t,e)=>{const l=it("router-link");return i(),h(k,null,[a(et,{padding:""},{default:y(()=>[a(xt),a(Vt),a(yt)]),_:1}),a(l,{to:"/lufs",class:"btn"},{default:y(()=>[a(C,{color:"primary"},{default:y(()=>[a(L,{left:"",size:"3em",name:"ssid_chart"}),e[0]||(e[0]=m("div",null,"luf chart",-1))]),_:1})]),_:1}),a(l,{to:"/audio-rt",class:"btn"},{default:y(()=>[a(C,{color:"primary"},{default:y(()=>[a(L,{left:"",size:"3em",name:"graphic_eq"}),e[1]||(e[1]=m("div",null,"audio rt chart",-1))]),_:1})]),_:1})],64)}}};export{ee as default};
