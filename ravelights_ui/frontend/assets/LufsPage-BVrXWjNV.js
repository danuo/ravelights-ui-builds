import{Q as P}from"./QRange-kU-1Ep_i.js";import{c as m,a as w,u as E}from"./uPlot.min-4xhVlTlW.js";import{v as B,r as g,G as D,aG as p,t as L,w as v,z as A,A as N,L as d,B as V}from"./index-C64imV-x.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-slider-FYktO69x.js";import"./selection-WXO3yDDh.js";const T={class:"wrapper"},C={class:"row items-center q-pa-md bg-dark"},H={class:"col"},S="/rest/audio",U=1500,c=100,b="lufs-dbRange",j=B({__name:"LufsPage",setup(G){const n=[[],[],[],[]],i=g(null),l=g({min:-60,max:-35});let s=null,r=null;function _(e){if(typeof e!="object"||e===null)return!1;const t=e;return typeof t.min=="number"&&typeof t.max=="number"}const u=(e,t)=>({id:"lufs-chart",class:"lufs-chart",width:e,height:t,ms:1,pxAlign:!1,series:[{label:"time"},{label:"rms",stroke:w[0],width:2,scale:"db",value:(a,o)=>o+" dB"},{label:"lufs",stroke:w[1],width:2,scale:"db",value:(a,o)=>o+" LUFS"},{label:"avg lufs",stroke:"#ff1f5a",width:2,dash:[10,5],scale:"db",value:(a,o)=>o+" LUFS"}],scales:{x:{time:!0},db:{auto:!1,min:l.value.min,max:l.value.max}},axes:[{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}},{scale:"db",stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"},label:"level (dB)"}],legend:{show:!0,live:!1},cursor:{show:!0,drag:{x:!1,y:!1},lock:!1}});async function f(){try{const e=await fetch(S);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();n[0]=t.time_unix||[],n[1]=t.rms_db||[],n[2]=t.lufs||[];let a=0;const o=n[2];if(o.length>0){const h=o.slice(-15);a=h.reduce((R,I)=>R+I,0)/h.length}n[3]=new Array(n[0].length).fill(a),s&&s.setData(n)}catch(e){console.error("Error fetching data:",e)}}function x(){s&&s.setSize({width:window.innerWidth,height:window.innerHeight-c})}D(()=>{const e=p.getItem(b);if(_(e)&&(l.value=e),i.value){const t=window.innerWidth,a=window.innerHeight-c;s=new m(u(t,a),n,i.value),f(),r=window.setInterval(()=>{f()},U)}}),L(()=>{r&&clearInterval(r),s&&(s.destroy(),s=null)});const{width:k,height:y}=E();return v([k,y],()=>{x()}),v(l,e=>{if(p.set(b,e),s&&i.value){s.destroy(),s=null;const t=window.innerWidth,a=window.innerHeight-c;s=new m(u(t,a),n,i.value)}},{deep:!0}),(e,t)=>(N(),A("div",T,[d("div",{ref_key:"chartContainer",ref:i},null,512),d("div",C,[d("div",H,[V(P,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=a=>l.value=a),min:-100,max:0,color:"green","label-always":""},null,8,["modelValue"])])])]))}}),Y=z(j,[["__scopeId","data-v-51500f40"]]);export{Y as default};
