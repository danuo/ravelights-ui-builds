import{Q as E}from"./QPage-Cbhyhk79.js";import{F as A}from"./FancyToggleComponent-DLjsFEiO.js";import{c as B,s as I}from"./stats-store-BAUTCUfw.js";import{u as U,a as V}from"./uPlot.min-4xhVlTlW.js";import{U as M}from"./uplot-vue-DQ2TpAw2.js";import{v as W,r as y,w as C,a5 as F,z as g,A as u,L as r,D as N,B as f,E as _,M as k,x as R,y as z,a6 as H,t as L,aK as Q,a2 as G,a4 as O,N as K,C as T,Q as X}from"./index-C64imV-x.js";import{U as Z}from"./UniversalControlComponent-eNzIUvuq.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ringbuffer-2FsxNW-2.js";import"./QItemLabel-BYWQF9Ag.js";import"./QToggle-DhzNXClp.js";import"./option-sizes-C1diCZAu.js";import"./selection-WXO3yDDh.js";import"./QItemSection-BmVL0r7k.js";import"./QSlider-D3u0tSoz.js";import"./use-slider-FYktO69x.js";import"./QRange-kU-1Ep_i.js";import"./QSelect-CqHlPZbo.js";import"./use-key-composition-CD61k5zG.js";import"./uid-Bzmka5Fh.js";import"./QChip-B8rYizlk.js";const J={class:"row q-col-gutter-sm q-pb-sm"},Y={class:"col-6"},ee={key:0,style:{"background-color":"black"}},D=300,te=W({__name:"NetworkChartUplot",setup(S){const a=y(!1),s=I.reactivityTrigger,v=[[],[]];let o=null;function w(t){o=t}const d=Array.from({length:B},(t,m)=>m);C(s,()=>{if(!o)return;const t=I.data.recentAll();o.setData([d.slice(0,t.length),t])});const{width:l}=U();C(l,()=>{i()});function x(){return document.body.clientWidth-32}function i(){const t=x();b.width=t,o&&o.setSize({width:t,height:D})}F(()=>{i()});const b={width:x(),height:D,pxAlign:!1,series:[{label:"Date"},{label:"",points:{show:!0},stroke:"rgb(182, 252, 78)",width:2,fill:"rgba(147, 79, 255,0.5)"}],axes:[{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}},{label:"Î” latency [ms]",auto:!1,stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}}],scales:{x:{time:!1},y:{range:(t,m,h)=>{let p=Math.max(Math.abs(m),Math.abs(h));return p=Math.max(p,10),[-p,p]}}},cursor:{show:!1,drag:{x:!1,y:!1},lock:!0},legend:{show:!1}};return(t,m)=>(u(),g(k,null,[r("div",J,[r("div",Y,[f(A,{modelValue:a.value,"onUpdate:modelValue":m[0]||(m[0]=h=>a.value=h),label:"Show Stats",icon:"show_chart",fancy:"",muted:""},null,8,["modelValue"])])]),a.value?(u(),g("div",ee,[f(_(M),{data:v,options:b,onCreate:w})])):N("",!0)],64))}}),ae={class:"row q-col-gutter-sm q-pb-sm"},se={class:"col-6"},oe={class:"col-6"},re={style:{"background-color":"black"}},ne={class:"q-py-lg"},le={class:"row items-center"},ie={class:"col-6"},ce=1e3/20*300-50,q=500,de=W({__name:"PerformanceChartUplot",setup(S){const a=y(!1),s=y(!1),v=R(),{settings:o}=z(v),w=y(0);let d,l=null;function x(e){l=e}const i=[[],[],[]],b={ms:1,width:h(),height:q,pxAlign:!1,series:[{label:"time"},{label:"cap",stroke:V[0],width:2,scale:"cap"},{label:"fps",stroke:V[1],width:2,scale:"fps"}],scales:{x:{time:!0},cap:{range:(e,n,c)=>!Number.isFinite(n)||!Number.isFinite(c)?[0,40]:[0,Math.ceil(c+50)]},fps:{range:()=>[15,25]}},axes:[{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}},{stroke:"#aab1bf",scale:"cap",label:"cap [f/s]"},{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"},scale:"fps",label:"fps [f/s]",side:1}],legend:{show:!0,live:!1},cursor:{show:!1,drag:{x:!1,y:!1},lock:!0}};async function t(){if(!l)return;const e=await O("/rest/performance");console.log("Performance data:",e.time.slice(-5),e.fps.slice(-5));const n=e.time_unix||[],c=e.fps_cap||[],$=e.fps||[];i[0]=n,i[1]=c,i[2]=$,l.setData(i),w.value=(e.delayed_frames||[]).slice(-1)[0]||0}const{width:m}=U();C(m,()=>{console.log("Width changed, refreshing performance chart width"),p()});function h(){return console.log("body width:",document.body.clientWidth),document.body.clientWidth-32}function p(){const e=h();b.width=e,l&&l.setSize({width:e,height:q})}F(()=>{s.value=!0,p()}),H(()=>{s.value=!1}),L(()=>{d&&clearInterval(d)}),Q(()=>{s.value&&a.value&&!o.value.performance_mode?(d&&clearInterval(d),t(),d=window.setInterval(()=>{t()},1e3),requestAnimationFrame(P)):d&&clearInterval(d)});function P(){if(!s.value||!a.value||!l||i===void 0)return;const e=Date.now(),c={min:e-ce,max:e};l.setData(i,!1),l.setScale("x",c),requestAnimationFrame(P)}return(e,n)=>(u(),g(k,null,[r("div",ae,[r("div",se,[f(A,{modelValue:_(o).performance_mode,"onUpdate:modelValue":n[0]||(n[0]=c=>_(o).performance_mode=c),callback:()=>_(v).set_settings("performance_mode"),label:"Performance Mode",icon:"rocket_launch",fancy:"",muted:""},null,8,["modelValue","callback"])]),r("div",oe,[f(A,{modelValue:a.value,"onUpdate:modelValue":n[1]||(n[1]=c=>a.value=c),label:"Show Stats",icon:"show_chart",fancy:"",muted:""},null,8,["modelValue"])])]),a.value?(u(),g(k,{key:0},[r("div",re,[f(_(M),{data:i,options:b,onCreate:x})]),r("div",ne,[r("div",le,[n[2]||(n[2]=r("div",{class:"col-6"},"Delayed Frames:",-1)),r("div",ie,G(w.value),1)])])],64)):N("",!0)],64))}}),me={class:"fancy-grid"},ue={__name:"PerformanceControlsComponent",setup(S){const a=R();return(s,v)=>(u(),g("div",me,[(u(!0),g(k,null,K(_(a).meta.controls_performance,o=>(u(),T(Z,{key:o.label,button:o},null,8,["button"]))),128))]))}},fe=j(ue,[["__scopeId","data-v-fb82b2f5"]]),Fe={__name:"PerformancePage",setup(S){return(a,s)=>(u(),T(E,{padding:""},{default:X(()=>[s[0]||(s[0]=r("div",{class:"text-caption q-pt-md q-px-sm"},"Network Settings",-1)),f(te),s[1]||(s[1]=r("div",{class:"text-caption q-pt-md q-px-sm"},"Performance Settings",-1)),f(de),f(fe)]),_:1}))}};export{Fe as default};
