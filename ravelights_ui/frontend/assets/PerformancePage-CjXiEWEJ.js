import{Q as B}from"./QPage-CDAJw4Yg.js";import{F as A}from"./FancyToggleComponent-Btc4ml15.js";import{u as U}from"./index-CTy3wcqf.js";import{c as z,s as V}from"./stats-store-DIrrxdhP.js";import{U as F}from"./uplot-vue-BhQPXQT-.js";import{u as I}from"./uPlot.min-BqCnoSue.js";import{x as M,r as g,w as C,a6 as N,A as w,B as u,L as o,E as T,C as d,F as b,M as y,y as E,z as H,a7 as L,t as W,aL as G,P as O,a5 as Q,N as X,D as R,V as Z}from"./index-BeSqqPMt.js";import{U as j}from"./UniversalControlComponent-B71nCMG8.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ringbuffer-2FsxNW-2.js";import"./QItemLabel-BZgobHJ-.js";import"./QToggle-D00Rwl_C.js";import"./selection-Dn_480wZ.js";import"./QItemSection-DwiZm1F9.js";import"./QSlider-i6zreaiN.js";import"./use-slider-Cnf7bwBN.js";import"./QRange-eewKsK1f.js";import"./QSelect-DHDFFpp1.js";import"./use-key-composition-COiGmTRB.js";import"./uid-Bzmka5Fh.js";import"./QChip-Dux6ckr4.js";import"./mappingFunctions-BCojnXZg.js";const K={class:"col-6"},Y={key:0,style:{"background-color":"black"}},D=300,ee=M({__name:"NetworkChartUplot",setup(S){let t=null;function i(e){t=e}const _=g(null),{width:s}=U(_),f=V.reactivityTrigger,m=g(!1),x=[[],[]],k=Array.from({length:z},(e,c)=>c);C(f,()=>{if(!t)return;const e=V.data.recentAll();t.setData([k.slice(0,e.length),e])}),C(s,()=>{v(s.value)});function v(e){l.width=e,t&&t.setSize({width:e,height:D})}N(()=>{v(s.value)});const l={width:s.value,height:D,pxAlign:!1,series:[{label:"Date"},{label:"",points:{show:!0},stroke:"rgb(182, 252, 78)",width:2,fill:"rgba(147, 79, 255,0.5)"}],axes:[{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}},{label:"Î” latency [ms]",auto:!1,stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}}],scales:{x:{time:!1},y:{range:(e,c,h)=>{let p=Math.max(Math.abs(c),Math.abs(h));return p=Math.max(p,10),[-p,p]}}},cursor:{show:!1,drag:{x:!1,y:!1},lock:!0},legend:{show:!1}};return(e,c)=>(u(),w(y,null,[o("div",{class:"row q-col-gutter-sm q-pb-sm",ref_key:"container",ref:_},[o("div",K,[d(A,{modelValue:m.value,"onUpdate:modelValue":c[0]||(c[0]=h=>m.value=h),label:"Show Stats",icon:"show_chart",fancy:"",muted:""},null,8,["modelValue"])])],512),m.value?(u(),w("div",Y,[d(b(F),{data:x,options:l,onCreate:i})])):T("",!0)],64))}}),te={class:"col-6"},ae={class:"col-6"},se={style:{"background-color":"black"}},oe={class:"q-py-lg"},re={class:"row items-center"},le={class:"col-6"},ne=1e3/20*300-50,q=500,ie=M({__name:"PerformanceChartUplot",setup(S){let t=null;function i(a){t=a}const _=g(null),{width:s}=U(_),f=g(!1),m=g(!1),x=g(0),k=E(),{settings:v}=H(k);let l;const e=[[],[],[]],c={ms:1,width:s.value,height:q,pxAlign:!1,series:[{label:"time"},{label:"cap",stroke:I[0],width:2,scale:"cap"},{label:"fps",stroke:I[1],width:2,scale:"fps"}],scales:{x:{time:!0},cap:{range:(a,r,n)=>!Number.isFinite(r)||!Number.isFinite(n)?[0,40]:[0,Math.ceil(n+50)]},fps:{range:()=>[15,25]}},axes:[{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}},{stroke:"#aab1bf",scale:"cap",label:"cap [f/s]"},{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"},scale:"fps",label:"fps [f/s]",side:1}],legend:{show:!0,live:!1},cursor:{show:!1,drag:{x:!1,y:!1},lock:!0}};async function h(){if(!t)return;const a=await Q("/rest/performance");console.log("Performance data:",a.time.slice(-5),a.fps.slice(-5));const r=a.time_unix||[],n=a.fps_cap||[],$=a.fps||[];e[0]=r,e[1]=n,e[2]=$,t.setData(e),x.value=(a.delayed_frames||[]).slice(-1)[0]||0}C(s,()=>{p(s.value)});function p(a){c.width=a,t&&t.setSize({width:a,height:q})}N(()=>{m.value=!0,p(s.value)}),L(()=>{m.value=!1}),W(()=>{l&&clearInterval(l)}),G(()=>{m.value&&f.value&&!v.value.performance_mode?(l&&clearInterval(l),h(),l=window.setInterval(()=>{h()},1e3),requestAnimationFrame(P)):l&&clearInterval(l)});function P(){if(!m.value||!f.value||!t||e===void 0)return;const a=Date.now(),n={min:a-ne,max:a};t.setData(e,!1),t.setScale("x",n),requestAnimationFrame(P)}return(a,r)=>(u(),w(y,null,[o("div",{class:"row q-col-gutter-sm q-pb-sm",ref_key:"container",ref:_},[o("div",te,[d(A,{modelValue:b(v).performance_mode,"onUpdate:modelValue":r[0]||(r[0]=n=>b(v).performance_mode=n),callback:()=>b(k).set_settings("performance_mode"),label:"Performance Mode",icon:"rocket_launch",fancy:"",muted:""},null,8,["modelValue","callback"])]),o("div",ae,[d(A,{modelValue:f.value,"onUpdate:modelValue":r[1]||(r[1]=n=>f.value=n),label:"Show Stats",icon:"show_chart",fancy:"",muted:""},null,8,["modelValue"])])],512),f.value?(u(),w(y,{key:0},[o("div",se,[d(b(F),{data:e,options:c,onCreate:i})]),o("div",oe,[o("div",re,[r[2]||(r[2]=o("div",{class:"col-6"},"Delayed Frames:",-1)),o("div",le,O(x.value),1)])])],64)):T("",!0)],64))}}),ce={class:"fancy-grid"},me={__name:"PerformanceControlsComponent",setup(S){const t=E();return(i,_)=>(u(),w("div",ce,[(u(!0),w(y,null,X(b(t).meta.controls_performance,s=>(u(),R(j,{key:s.label,button:s},null,8,["button"]))),128))]))}},ue=J(me,[["__scopeId","data-v-fb82b2f5"]]),Me={__name:"PerformancePage",setup(S){return(t,i)=>(u(),R(B,{padding:""},{default:Z(()=>[i[0]||(i[0]=o("div",{class:"text-caption q-pt-md q-px-sm"},"Network Settings",-1)),d(ee),i[1]||(i[1]=o("div",{class:"text-caption q-pt-md q-px-sm"},"Performance Settings",-1)),d(ie),d(ue)]),_:1}))}};export{Me as default};
