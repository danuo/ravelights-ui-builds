import{Q as et}from"./QPage-Cbhyhk79.js";import{x as T,y as v,d as st,z as f,A as c,D,L as m,E as u,B as o,S,M as k,a1 as N,C,Q as y,N as E,a3 as ot,a4 as at,v as O,r as j,w as F,a5 as K,a6 as X,F as it,P as nt,_ as L}from"./index-C64imV-x.js";import{Q as lt}from"./QInput-B-duVVNT.js";import{Q as rt}from"./QSlider-D3u0tSoz.js";import{Q as W}from"./QList-DxOH80ki.js";import{U as Q}from"./UniversalControlComponent-eNzIUvuq.js";import{u as Y,a as P}from"./uPlot.min-4xhVlTlW.js";import{u as B}from"./app-store-KGWziJk4.js";import{A as U}from"./AudioEnums-C20TDQqa.js";import{U as Z}from"./uplot-vue-DQ2TpAw2.js";import{F as M}from"./FancyToggleComponent-DLjsFEiO.js";import"./use-key-composition-CD61k5zG.js";import"./uid-Bzmka5Fh.js";import"./selection-WXO3yDDh.js";import"./use-slider-FYktO69x.js";import"./QItemLabel-BYWQF9Ag.js";import"./QToggle-DhzNXClp.js";import"./option-sizes-C1diCZAu.js";import"./QItemSection-BmVL0r7k.js";import"./QRange-kU-1Ep_i.js";import"./QSelect-CqHlPZbo.js";import"./QChip-B8rYizlk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ut={key:0,class:"q-mt-xs q-col-gutter-xs bpm-custom-styles"},ct={class:"row"},dt={class:"col-6",id:"bpm_input"},mt={class:"col-3"},pt={class:"col-3"},_t={class:"row"},ft={class:"col-6"},bt={class:"col-3"},ht={class:"col-3"},vt={class:"q-px-none q-mt-lg q-mb-md"},gt={class:"row flex-center",style:{width:"100%"}},xt={__name:"BpmComponent",setup(g){const e=T(),{settings:s}=v(e),l={0:"1/2",1:1,2:2},p=st({get(){return s.value.bpm_multiplier==.5?0:s.value.bpm_multiplier},set(d){s.value.bpm_multiplier=d==0?.5:d}});function n(){N("/rest/settings",{action:"set_sync"})}function _(d){N("/rest/settings",{action:"adjust_sync",value:d})}function b(d){s.value.bpm_base=parseFloat((s.value.bpm_base+d).toFixed(2)),e.set_settings("bpm_base")}return(d,t)=>(c(),f(k,null,[Object.keys(u(s)).length>0?(c(),f("div",ut,[m("div",ct,[m("div",dt,[o(lt,{modelValue:u(s).bpm_base,"onUpdate:modelValue":t[0]||(t[0]=i=>u(s).bpm_base=i),modelModifiers:{number:!0},outlined:""},null,8,["modelValue"])]),m("div",mt,[o(S,{onClick:t[1]||(t[1]=i=>b(.1)),square:!0,color:"primary",icon:"expand_less",size:"20px"})]),m("div",pt,[o(S,{onClick:t[2]||(t[2]=i=>b(-.1)),color:"primary",icon:"expand_more",size:"20px"})])]),m("div",_t,[m("div",ft,[o(S,{onClick:t[3]||(t[3]=i=>n()),label:"sync",color:"primary",size:"20px"})]),m("div",bt,[o(S,{onClick:t[4]||(t[4]=i=>_(.1)),color:"primary",icon:"navigate_before",size:"20px"})]),m("div",ht,[o(S,{onClick:t[5]||(t[5]=i=>_(-.1)),color:"primary",icon:"navigate_next",size:"20px"})])])])):D("",!0),m("div",vt,[t[8]||(t[8]=m("div",{style:{"padding-left":"16px"},class:"text-caption"},"bpm multiplier",-1)),m("div",gt,[o(rt,{onChange:t[6]||(t[6]=i=>u(e).set_settings("bpm_multiplier")),modelValue:p.value,"onUpdate:modelValue":t[7]||(t[7]=i=>p.value=i),color:"secondary","selection-color":"secondary","track-size":"15px","thumb-size":"30px",min:0,max:2,"marker-labels":l,snap:"",style:{width:"66%"}},null,8,["modelValue"])])])],64))}},yt={__name:"GeneralSettingsComponent",setup(g){const e=T();return(s,l)=>(c(),C(W,{bordered:"",separator:""},{default:y(()=>[(c(!0),f(k,null,E(u(e).meta.controls_global_sliders,p=>(c(),C(Q,{key:p.label,button:p},null,8,["button"]))),128))]),_:1}))}},kt=1500,J=ot("audio-aggr-store",{state:()=>({data:null,subscribers:0,totalTimeFrame:1,intervalId:null}),actions:{async fetchData(){console.log("fetching data"),this.data=await at("/rest/audio"),this.totalTimeFrame===1&&this.setTotalTimeFrame()},setTotalTimeFrame(){if(!this.data)return;const g=this.data.time_unix[0],s=this.data.time_unix[this.data.time_unix.length-1]-g,l=this.data.time_unix.length,p=this.data.capacity;this.totalTimeFrame=s/l*p},startFetching(){this.subscribers>0&&!this.intervalId&&(this.fetchData(),this.intervalId=setInterval(()=>void this.fetchData(),kt))},stopFetching(){this.subscribers===0&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},subscribe(){return console.log("subscribed"),this.subscribers++,this.startFetching(),()=>{this.subscribers--,this.stopFetching()}}}}),wt={key:0,style:{background:"black"}},G=500,St=O({__name:"AudioEnergyChartUplot",setup(g){const e=j(!1),s=T(),{settings:l}=v(s),p=B(),{enable_charts:n}=v(p),_=J(),{data:b,totalTimeFrame:d}=v(_);let t=null;const i=[U.level_low_filter,U.mapped,U.max,U.min,U.mean],A=[[],...i.map(()=>[])];let h=null;function R(a){h=a}const I={ms:1,width:$(),height:G,pxAlign:!1,series:[{label:"time"},...i.map(a=>({label:a,stroke:P[i.indexOf(a)],width:2}))],scales:{x:{time:!0},y:{auto:!1,range:[0,1]}},axes:[{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}},{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}}],legend:{show:!0,live:!1},cursor:{show:!1,drag:{x:!1,y:!1},lock:!0}};F(b,a=>{if(!h||!a)return;const w=a.time_unix||[];A[0]=w,i.forEach((q,tt)=>{A[tt+1]=a[q]})});const{width:z}=Y();F(z,()=>{V()});function $(){return document.body.clientWidth-32-6}function V(){const a=$();I.width=a,h&&h.setSize({width:a,height:G})}K(()=>{e.value=!0,V()}),X(()=>{e.value=!1}),F([e,n,l],([a,w,q])=>{a&&w&&!q.performance_mode?(r(),t=_.subscribe(),requestAnimationFrame(x)):r()});function r(){t&&(t(),t=null)}function x(){if(!e.value||!n.value||l.value.performance_mode||!h)return;const a=Date.now();console.log(d.value);const q={min:a-d.value,max:a};h.setData(A,!1),h.setScale("x",q),requestAnimationFrame(x)}return(a,w)=>u(n)?(c(),f("div",wt,[o(u(Z),{data:A,options:I,onCreate:R})])):D("",!0)}}),At={key:0,style:{background:"black"}},H=500,Ct=1e3/20*300-50,Ft=O({__name:"AudioGainChartUplot",setup(g){const e=j(!1),s=T(),{settings:l}=v(s),p=B(),{enable_charts:n}=v(p),_=J(),{data:b}=v(_);let d=null;const t=[[],[],[]];let i=null;function A(r){i=r}const h={ms:1,width:I(),height:H,pxAlign:!1,series:[{label:"time"},{label:"rms",stroke:P[0],width:2,scale:"db"},{label:"lufs",stroke:P[1],width:2,scale:"db"}],scales:{x:{time:!0},db:{auto:!0}},axes:[{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}},{scale:"db",stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"},label:"level"}],legend:{show:!0,live:!1},cursor:{show:!1,drag:{x:!1,y:!1},lock:!0}};F(b,r=>{if(!i||!r)return;const x=r.time_unix||[],a=r.rms_db||[],w=r.lufs||[];t[0]=x,t[1]=a,t[2]=w});const{width:R}=Y();F(R,()=>{z()});function I(){return document.body.clientWidth-32-6}function z(){const r=I();h.width=r,i&&i.setSize({width:r,height:H})}K(()=>{e.value=!0,z()}),X(()=>{e.value=!1}),F([e,n,l],([r,x,a])=>{r&&x&&!a.performance_mode?($(),d=_.subscribe(),requestAnimationFrame(V)):$()});function $(){d&&(d(),d=null)}function V(){if(!e.value||!n.value||l.value.performance_mode||!i)return;const r=Date.now(),a={min:r-Ct,max:r};i.setData(t,!1),i.setScale("x",a),requestAnimationFrame(V)}return(r,x)=>u(n)?(c(),f("div",At,[o(u(Z),{data:t,options:h,onCreate:A})])):D("",!0)}}),Tt={__name:"AudioSettingsComponent",setup(g){const e=T(),{settings:s}=v(e);return(l,p)=>(c(),f(k,null,[o(W,{bordered:"",separator:"",class:"q-my-md"},{default:y(()=>[o(Ft),(c(!0),f(k,null,E(u(e).meta.controls_audio.main,n=>(c(),C(Q,{key:n.label,button:n},null,8,["button"]))),128)),(c(!0),f(k,null,E(u(e).meta.controls_audio[u(s).audio_fade_mode],n=>(c(),C(Q,{key:n.label,button:n},null,8,["button"]))),128)),u(s).audio_fade_mode=="audio"?(c(),C(St,{key:0})):D("",!0)]),_:1}),o(W,{bordered:"",separator:"",class:"q-my-md"},{default:y(()=>[(c(!0),f(k,null,E(u(e).meta.controls_audio.blackout,n=>(c(),C(Q,{key:n.label,button:n},null,8,["button"]))),128))]),_:1})],64))}},It={class:"row q-col-gutter-sm q-pb-md"},$t={class:"col-6"},Vt={class:"col-6"},qt={__name:"AudioControlsWrapper",setup(g){const e=T(),s=B(),{enable_charts:l}=v(s),{settings:p}=v(e);return(n,_)=>(c(),f(k,null,[m("div",It,[m("div",$t,[o(M,{modelValue:u(p).enable_audio_analysis,"onUpdate:modelValue":_[0]||(_[0]=b=>u(p).enable_audio_analysis=b),callback:()=>u(e).set_settings("enable_audio_analysis"),label:"Audio Analysis",icon:"mic",muted:"",fancy:""},null,8,["modelValue","callback"])]),m("div",Vt,[o(M,{modelValue:u(l),"onUpdate:modelValue":_[1]||(_[1]=b=>it(l)?l.value=b:null),label:"Show Charts",icon:"show_chart",fancy:"",muted:""},null,8,["modelValue"])])]),o(Tt)],64))}},se={__name:"AudioPage",setup(g){return(e,s)=>{const l=nt("router-link");return c(),f(k,null,[o(et,{padding:""},{default:y(()=>[o(xt),o(qt),o(yt)]),_:1}),o(l,{to:"/lufs",class:"btn"},{default:y(()=>[o(S,{color:"primary"},{default:y(()=>[o(L,{left:"",size:"3em",name:"ssid_chart"}),s[0]||(s[0]=m("div",null,"luf chart",-1))]),_:1})]),_:1}),o(l,{to:"/audio-rt",class:"btn"},{default:y(()=>[o(S,{color:"primary"},{default:y(()=>[o(L,{left:"",size:"3em",name:"graphic_eq"}),s[1]||(s[1]=m("div",null,"audio rt chart",-1))]),_:1})]),_:1})],64)}}};export{se as default};
