import{Q as P}from"./QRange-eewKsK1f.js";import{a as m,u as w}from"./uPlot.min-BqCnoSue.js";import{u as E}from"./useResize-BQ3IKgzS.js";import{x as B,r as g,v as D,ai as p,t as L,w as v,A,B as N,L as d,C as V}from"./index-BeSqqPMt.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-slider-Cnf7bwBN.js";import"./selection-Dn_480wZ.js";const T={class:"wrapper"},z={class:"row items-center q-pa-md bg-dark"},H={class:"col"},S="/rest/audio",U=1500,c=100,b="lufs-dbRange",j=B({__name:"LufsPage",setup(W){const o=[[],[],[],[]],i=g(null),l=g({min:-60,max:-35});let a=null,r=null;function _(e){if(typeof e!="object"||e===null)return!1;const t=e;return typeof t.min=="number"&&typeof t.max=="number"}const u=(e,t)=>({id:"lufs-chart",class:"lufs-chart",width:e,height:t,ms:1,pxAlign:!1,series:[{label:"time"},{label:"rms",stroke:w[0],width:2,scale:"db",value:(s,n)=>n+" dB"},{label:"lufs",stroke:w[1],width:2,scale:"db",value:(s,n)=>n+" LUFS"},{label:"avg lufs",stroke:"#ff1f5a",width:2,dash:[10,5],scale:"db",value:(s,n)=>n+" LUFS"}],scales:{x:{time:!0},db:{auto:!1,min:l.value.min,max:l.value.max}},axes:[{stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"}},{scale:"db",stroke:"#aab1bf",grid:{width:1/devicePixelRatio,stroke:"#596170"},label:"level (dB)"}],legend:{show:!0,live:!1},cursor:{show:!0,drag:{x:!1,y:!1},lock:!1}});async function f(){try{const e=await fetch(S);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();o[0]=t.time_unix||[],o[1]=t.rms_db||[],o[2]=t.lufs||[];let s=0;const n=o[2];if(n.length>0){const h=n.slice(-15);s=h.reduce((R,I)=>R+I,0)/h.length}o[3]=new Array(o[0].length).fill(s),a&&a.setData(o)}catch(e){console.error("Error fetching data:",e)}}function x(){a&&a.setSize({width:window.innerWidth,height:window.innerHeight-c})}D(()=>{const e=p.getItem(b);if(_(e)&&(l.value=e),i.value){const t=window.innerWidth,s=window.innerHeight-c;a=new m(u(t,s),o,i.value),f(),r=window.setInterval(()=>{f()},U)}}),L(()=>{r&&clearInterval(r),a&&(a.destroy(),a=null)});const{width:k,height:y}=E();return v([k,y],()=>{x()}),v(l,e=>{if(p.set(b,e),a&&i.value){a.destroy(),a=null;const t=window.innerWidth,s=window.innerHeight-c;a=new m(u(t,s),o,i.value)}},{deep:!0}),(e,t)=>(N(),A("div",T,[d("div",{ref_key:"chartContainer",ref:i},null,512),d("div",z,[d("div",H,[V(P,{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=s=>l.value=s),min:-100,max:0,color:"green","label-always":""},null,8,["modelValue"])])])]))}}),$=C(j,[["__scopeId","data-v-0a47fe2d"]]);export{$ as default};
